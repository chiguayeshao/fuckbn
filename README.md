# 币安合约做空交易脚本

这是一个用于币安合约市场的自动化做空交易脚本，可以同时对多个交易对进行做空操作，并自动设置止盈止损。

## 功能特点

- 支持同时对多个交易对进行做空
- 自动设置止盈止损保护
- 可配置杠杆倍数、资金分配、止盈止损比例
- 全仓模式交易
- 自动重试机制，确保止盈止损设置成功
- 风险控制：如果无法设置止盈止损，自动平仓

## 安装步骤

1. 克隆或下载本仓库到本地
2. 安装所需的 Python 依赖包：

```bash
pip install python-binance pandas python-dotenv
```

## 配置说明

### 1. 设置 API 密钥

1. 在币安官网创建 API 密钥（需要开启合约交易权限）
2. 复制`.env.example`文件并重命名为`.env`
3. 在`.env`文件中填入您的 API 密钥：

```
BINANCE_API_KEY=您的API密钥
BINANCE_API_SECRET=您的API密钥密码
```

### 2. 配置交易参数

编辑`trading_config.py`文件，根据需要调整以下参数：

```python
TRADING_CONFIG = {
    # 初始资金（USDT）
    'initial_capital': 1000,

    # 每个币种分配的资金（USDT）
    'capital_per_coin': 20,

    # 杠杆倍数
    'leverage': 10,

    # 止损比例（百分比）
    'stop_loss_percent': 5,

    # 止盈比例（百分比）
    'take_profit_percent': 1,

    # 是否启用做空
    'enable_short': True,

    # 是否启用自动交易
    'enable_auto_trade': True,

    # 交易对文件路径
    'pairs_file': 'trading_pairs/latest_pairs.json'
}
```

### 3. 获取交易对列表

运行以下脚本自动获取币安合约市值前 50 的加密货币（不含 BTC 和 USDC）：

```bash
python binance_top_50.py
```

该脚本会：

1. 自动创建`trading_pairs`目录
2. 获取市值前 50 的加密货币交易对
3. 将交易对信息保存到`trading_pairs/latest_pairs.json`文件
4. 同时保存一份带时间戳的历史记录

**注意**：如果您没有配置 API 密钥，脚本将使用默认杠杆倍数 20 倍。要获取准确的杠杆倍数，请在`.env`文件中配置 API 密钥。

## 使用方法

1. 确保您已经正确配置了 API 密钥和交易参数
2. 确保您的币安合约账户中有足够的 USDT 余额
3. 运行交易脚本：

```bash
python short_trading.py
```

## 注意事项

1. **风险提示**：加密货币交易具有高风险，请确保您了解风险并谨慎操作
2. **资金安全**：请确保您的 API 密钥安全，不要泄露给他人
3. **账户余额**：确保您的合约账户中有足够的 USDT 余额
4. **杠杆风险**：高杠杆交易可能导致快速亏损，请谨慎设置杠杆倍数
5. **止盈止损**：脚本会自动设置止盈止损，但市场剧烈波动时可能无法完全避免损失

## 常见问题

1. **API 错误**：如果遇到 API 错误，请检查您的 API 密钥是否正确，以及是否有足够的权限
2. **余额不足**：如果遇到余额不足错误，请确保您的合约账户中有足够的 USDT
3. **止盈止损设置失败**：脚本会自动重试并调整价格，如果仍然失败，会自动平仓以避免风险
4. **交易对不可用**：某些交易对可能不可用或已下架，脚本会自动跳过这些交易对

## 自定义和扩展

您可以根据需要修改代码，例如：

- 调整重试次数和间隔
- 修改止盈止损的计算方式
- 添加更多的交易策略
- 集成其他交易所的 API

## 免责声明

本脚本仅供学习和研究使用，不构成投资建议。使用本脚本进行交易的风险由用户自行承担。作者不对使用本脚本导致的任何损失负责。
